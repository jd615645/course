$(document).ready(function(){window.user=return_init_user_json(),window.week=["一","二","三","四","五"]});var return_init_user_json=function(){return{user_name:"",user_dept:"",time_table:[],idList:{},returnarr:{degree:"",level:"",major:"",d_major:"",d_level:""}}},bulletin_post=function(t,e,i){if("object"!==$.type(e.title_parsed))throw"title_parsed error";"zh_TW"==i?e.title_short=e.title_parsed.zh_TW:e.title_short=e.title_parsed.en_US;var n=build_bulletin_time(e);$option=return_bulletin_option(e),$option.find("span.title").text(e.title_short),$option.find("span.time").text(n),$option.find("span.location").text(fill_loction(e)),$option.find("span.professor").text(e.professor),$option.find("button").val(e.code);var o=window.url_base+e.url;$option.find("a").attr("href",o),t.append($option),$('[data-toggle="tooltip"]').tooltip()},add_course=function(t,e,i){if(!$.isArray(e.time_parsed))throw"time_parsed error";if("object"!==$.type(e.title_parsed))throw"title_parsed error";if("zh_TW"==i){var n=e.title_parsed.zh_TW.split(" ");e.title_short=n[0]}else{var o=e.title_parsed.en_US;e.title_short=o}var a=!1;return $.each(e.time_parsed,function(e,i){return $.each(i.time,function(e,n){var o=t.find("tr[data-hour="+n+"] td:eq("+(i.day-1)+")");return""!=o.text()?(a=!0,"zh_TW"==window.language?toastr.error("衝堂喔!請手動刪除衝堂的課程",{timeOut:2500}):toastr.error("Conflict! please drop some course manually.",{timeOut:2500}),!1):void 0}),1==a?!1:void 0}),0==a&&($.each(e.time_parsed,function(i,n){$.each(n.time,function(i,o){var a=t.find("tr[data-hour="+o+"] td:eq("+(n.day-1)+")"),s=return_add_course_option();s.find(".title").text(e.title_short).end(),s.find("input").val(e.code).end().find(".professor").text(e.professor).end().find(".location").text(fill_loction(e)),a.html(s.html())})}),add_credits(e),window.user.time_table.push(e),window.user.idList[e.code]=courses[e.code][0].title_parsed.zh_TW,build_toastr_time(e,window.language)),window.already_post=!1,0==a?"available":"conflict"},add_major=function(t,e){console.log(t+" "+e),console.log(course_of_majors[t][e]),$.each(course_of_majors[t][e],function(i,n){$.each(courses[n],function(i,n){return 1==n.obligatory_tf&&n.for_dept==t&&n["class"]==e?(check_optional_obligatory(n),!1):void 0})}),$.each(course_of_majors[t][e],function(i,n){$.each(courses[n],function(i,n){if(n.for_dept==t&&n["class"]==e){var o=return_optional_obligatory_course_name(n);1==window.name_of_optional_obligatory[o]?0==n.time_parsed?bulletin_post($(".search_result"),n,language):add_course($("#time-table"),n,language):1==n.obligatory_tf&&show_optional_obligatory(n)}})}),$.each(course_of_majors[t],function(i,n){if(1==check_if_two_class(e).length)$.each(n,function(i,n){$.each(courses[n],function(i,n){0==n.obligatory_tf&&n.for_dept==t&&n["class"]==e&&check_which_bulletin(n)})});else{var o=e.split("")[1];i.split("")[1]==o&&$.each(n,function(e,n){$.each(courses[n],function(e,n){return 0==n.obligatory_tf&&n.for_dept==t&&n["class"].split("")[1]==o&&n["class"].split("")[0]==i.split("")[0]?(check_which_bulletin(n),!1):void 0})})}})},add_doublemajor=function(t,e){reset_for_time_request(),department_course_for_specific_search(t,e)},delete_course=function(t,e){if(e.for_dept==window.user.returnarr.d_major)var i="available2";else var i="available";$.each(e.time_parsed,function(e,i){$.each(i.time,function(e,n){var o=t.find("tr[data-hour="+n+"] td:eq("+(i.day-1)+")");o.empty()})}),minus_credits(e),change_color($("button[value="+e.code+"]"),i),$.each(window.user.time_table,function(t,i){return i.code==e.code?(window.user.time_table.splice(t,1),!1):void 0})},add_credits=function(t){window.credits+=parseInt(t.credits),$("#class_credit").text(window.credits)},minus_credits=function(t){window.credits-=parseInt(t.credits),$("#class_credit").text(window.credits)},change_color=function(t,e){"available"==e?t.parents("tr").find("td").eq(0).css("color","black"):"used"==e?t.parents("tr").find("td").eq(0).css("color","red"):"available2"==e?t.parents("tr").find("td").eq(0).css("color","#B53074"):alert("遇到不可預期的錯誤，請聯絡開發小組XD")},return_optional_obligatory_course_name=function(t){var e=t.title_parsed.zh_TW.length;return 1==isChar(t.title_parsed.zh_TW[e-1])?t.title_parsed.zh_TW.substring(0,e-1):t.title_parsed.zh_TW},check_optional_obligatory=function(t){t.title_short=return_optional_obligatory_course_name(t),"undefined"==typeof window.name_of_optional_obligatory[t.title_short]?window.name_of_optional_obligatory[t.title_short]=1:window.name_of_optional_obligatory[t.title_short]++},show_optional_obligatory=function(t){var e=return_optional_obligatory_course_name(t);window.name_of_optional_obligatory[e]>1&&bulletin_post($("#obligatory-post"),t,language)},check_if_two_class=function(t){return t=t.split("")},check_which_class=function(t,e){if("獸醫學系學士班 A"==t||"獸醫學系學士班 B"==t||"應用數學系學士班 A"==t||"應用數學系學士班 B"==t||"機械工程學系學士班 A"==t||"機械工程學系學士班 B"==t||"土木工程學系學士班 A"==t||"土木工程學系學士班 B"==t||"電機工程學系學士班 A"==t||"電機工程學系學士班 B"==t){var i=t.split(" ");i=i[1];var e=e;return e+=i}return e},check_which_bulletin=function(t){"1"==t["class"]||"1A"==t["class"]||"1B"==t["class"]?bulletin_post($(".search_result"),t,language):"2"==t["class"]||"2A"==t["class"]||"2B"==t["class"]?bulletin_post($(".search_result"),t,language):"3"==t["class"]||"3A"==t["class"]||"3B"==t["class"]?bulletin_post($(".search_result"),t,language):"4"==t["class"]||"4A"==t["class"]||"4B"==t["class"]?bulletin_post($(".search_result"),t,language):"5"==t["class"]||"5A"==t["class"]||"5B"==t["class"]?bulletin_post($(".search_result"),t,language):"6"==t["class"]||"6A"==t["class"]||"6B"==t["class"]?bulletin_post($(".search_result"),t,language):"7"==t["class"]||"7A"==t["class"]||"7B"==t["class"]?bulletin_post($(".search_result"),t,language):"8"==t["class"]||"8A"==t["class"]||"8B"==t["class"]?bulletin_post($(".search_result"),t,language):"9"==t["class"]||"9A"==t["class"]||"9B"==t["class"]?bulletin_post($(".search_result"),t,language):"0"==t["class"]?bulletin_post($(".search_result"),t,language):alert("check_which_bulletin ERROR,麻煩您到粉專通知開發人員喔")},check_which_bulletin_required=function(t){var e={"語言中心":"","夜共同科":"","夜外文":""},i={"通識教育中心":"","夜中文":""};void 0!=t.discipline&&""!=t.discipline?check_general(t):t.department in e?bulletin_post($("#english"),t,language):t.department in i?bulletin_post($("#chinese"),t,language):"體育室"==t.department||"夜共同科"==t.department?bulletin_post($("#PE-post"),t,language):"師資培育中心"==t.department?bulletin_post($("#teacher-post"),t,language):bulletin_post($("#obligatory-post"),t,language)},department_course_for_specific_search=function(t,e){$.each(course_of_majors[t][e],function(i,n){$.each(courses[n],function(i,n){if(n.for_dept==t){if(1==n.obligatory_tf&&n["class"]==e)return bulletin_post($("#obligatory-post"),n,language),!1;if(0==n.obligatory_tf&&n["class"]==e)return check_which_bulletin(n),!1}})})},check_general=function(t){var e={"文學學群":"","歷史學群":"","哲學學群":"","藝術學群":"","文化學群":""},i={"公民與社會學群":"","法律與政治學群":"","商業與管理學群":"","心理與教育學群":"","資訊與傳播學群":""},n={"生命科學學群":"","環境科學學群":"","物質科學學群":"","數學統計學群":"","工程科技學群":""};t.discipline in e?bulletin_post($("#humanities"),t,language):t.discipline in i?bulletin_post($("#social"),t,language):t.discipline in n?bulletin_post($("#natural"),t,language):alert("有通識課程無法顯示，煩請記下點擊的結束為何並告知開發小組\nFB搜尋：選課小幫手\nhttps://www.facebook.com/CoursePickingHelper")},check_which_common_subject=function(t){"師資培育中心"==t.department?bulletin_post($("#teacher-post"),t,language):"教官室"==t.department?bulletin_post($("#military-post"),t,language):"語言中心"==t.department?bulletin_post($("#foreign-post"),t,language):bulletin_post($("#non-graded-optional-post"),t,language)},build_bulletin_time=function(t){var e=[];return $.each(t.time_parsed,function(t,i){e.push("星期"+week[i.day-1]+i.time)}),""!=t.intern_time&&void 0!=t.intern_time&&e.push("實習時間:"+t.intern_time),""!=t.discipline&&void 0!=t.discipline&&e.push("學群:"+t.discipline),e=e.join(" ")},build_toastr_time=function(t,e){var i,n,o=[];if("zh_TW"==e?(i="代碼:",n="剩餘名額:",o.push("課名:"+t.title_parsed[window.language])):"en_US"==e&&(i="Course ID:",n="Remaining Seat:",o.push("Title:"+t.title_parsed[window.language])),o.push(i+t.code),o.push(n+(t.number-t.enrolled_num)),""!=t.discipline&&void 0!=t.discipline){"zh_TW"==e?i="學群:":"en_US"==e&&(i="Discipline:"),o.push(i+t.discipline);cal_possibility(t)}""!=t.note&&("zh_TW"==e?i="備註:":"en_US"==e&&(i="Note:"),o.push(i+t.note)),""!=t.prerequisite&&("zh_TW"==e?i="先修科目:":"en_US"==e&&(i="Prerequisite:"),o.push(i+t.prerequisite)),o=o.join("<br/>"),toastr.info(o)},credits_filter=function(){var t=$("#credits").val();return""!=t?t:!0},code_search=function(t){""!=t&&(bulletin_post($(".search_result"),courses[t][0],language),$("#class_code").val(""))},title_search=function(t,e){condition=e;var i=[];""!=t&&($.each(name_of_course,function(e,n){-1!=e.search(t)&&$.each(n,function(t,e){-1!=i.indexOf(e.code)||e.credits!=condition&&1!=condition||(bulletin_post($(".search_result"),e,language),i.push(e.code))})}),$("#class_title").val(""))},teach_search=function(t,e){condition=e,""!=t&&($.each(teacher_course[t],function(t,e){(e.credits==condition||1==condition)&&bulletin_post($(".search_result"),e,language)}),$("#class_teacher").val(""))},fill_loction=function(t){var e="";return t.location!=[""]&&void 0!=t.location&&$.each(t.location,function(t,i){e=e+" "+i}),t.intern_location!=[""]&&void 0!=t.intern_location&&$.each(t.intern_location,function(t,i){e=e+" "+i}),e},get_major_and_level=function(){var t=$("form").serializeArray();window.user.returnarr.degree=t[0].value;var e;e=t[1].value.split("-")[1],window.user.returnarr.level=check_which_class(e,t[2].value),window.user.returnarr.major=e.split(" ")[0],e=t[3].value.split("-")[1],window.user.returnarr.d_level=check_which_class(e,t[4].value),window.user.returnarr.d_major=e.split(" ")[0]},return_major_and_level=function(t,e){var i,n=[];return i=t.split("-")[1],n.push(check_which_class(i,e)),n.push(i.split(" ")[0]),n},cal_possibility=function(t){var e=(t.number-t.enrolled_num)/t.number*100;return e=new Number(e),e=e.toFixed(2),0>e?0:e},isChar=function(t){var e=t.charCodeAt(0);return e>=65&&90>=e||e>=97&&122>=e?!0:!1},return_bulletin_option=function(t){if(t.for_dept==window.user.returnarr.d_major)var e=$($.parseHTML('<tr  class="text-center"><th><h5 class=""><img src="https://maxcdn.icons8.com/iOS7/PNG/25/Very_Basic/plus-25.png" title="Plus" title="Exit" width="25"></h5></th><td ><span class="title" style="color:#B53074;></span></td><td ><span class="time"></span></td><td ><span class="location"></span></td><td ><span class="professor"></span></td></tr>'));else var e=$($.parseHTML('<tr  class="text-center"><th><h5 class=""><button type="button" class="btn btn-link" data-toggle="tooltip" data-placement="top" style="color:#B53074;" title="" value=""><img src="https://maxcdn.icons8.com/iOS7/PNG/25/Very_Basic/plus-25.png" title="Plus" title="Exit" width="25"></button></h5></th><td ><span class="title"></span></td><td ><span class="time"></span></td><td ><span class="location"></span></td><td ><span class="professor"></span></td></tr>'));return e},return_add_course_option=function(){return $($.parseHTML('<div><div style="height: 21px;"><button type="button" class="close delete" data-dismiss="alert" aria-label="Close" style="color:red;"><span aria-hidden="true"  style="color:red;">&times;</span><input type="hidden" name="code-of-course" value=""></button><a href="/course/supply_book_info/"><button type="button" class="close fa fa-book"style=":blue;font-size: 1rem;"></button></a></div><div class="title"></div><div class=""><div class="professor "></div><div class="location "></div>'))};